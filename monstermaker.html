<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Monster Maker</title>
<link rel="stylesheet" href="css/style.css">
</head>
<body>

<h1>Monster Maker</h1>

<form id="monster-form">
<label>Name</label>
<input type="text" id="monster-name" placeholder="Goblin">

<label>Type</label>
<select id="monster-type">
<option value="aberration">Aberration</option>
<option value="beast">Beast</option>
<option value="celestial">Celestial</option>
<option value="construct">Construct</option>
<option value="dragon">Dragon</option>
<option value="elemental">Elemental</option>
<option value="fey">Fey</option>
<option value="fiend">Fiend</option>
<option value="giant">Giant</option>
<option value="humanoid">Humanoid</option>
<option value="monstrosity">Monstrosity</option>
<option value="ooze">Ooze</option>
<option value="plant">Plant</option>
<option value="undead">Undead</option>
</select>

<label>Alignment</label>
<select id="monster-alignment">
<option>Lawful Good</option>
<option>Lawful Neutral</option>
<option>Lawful Evil</option>
<option>Neutral Good</option>
<option>True Neutral</option>
<option>Neutral Evil</option>
<option>Chaotic Good</option>
<option>Chaotic Neutral</option>
<option>Chaotic Evil</option>
</select>

<label>Size</label>
<select id="monster-size">
<option>Small</option>
<option>Medium</option>
<option>Large</option>
<option>Huge</option>
<option>Gargantuan</option>
</select>

<label>AC</label>
<input type="number" id="monster-ac" placeholder="15">

<label>HP</label>
<input type="number" id="monster-hp" placeholder="30">

<label>Speed</label>
<input type="text" id="monster-speed" placeholder="30 ft.">

<label>Source</label>
<input type="text" id="monster-source" placeholder="Monster Manual">

<div class="section">
<h3>Abilities</h3>
<div class="row">
<label>STR <input type="number" id="str" placeholder="0"></label>
<label>DEX <input type="number" id="dex" placeholder="0"></label>
<label>CON <input type="number" id="con" placeholder="0"></label>
<label>INT <input type="number" id="int" placeholder="0"></label>
<label>WIS <input type="number" id="wis" placeholder="0"></label>
<label>CHA <input type="number" id="cha" placeholder="0"></label>
</div>
</div>

<div class="section">
  <label for="savingThrows">Saving Throws</label>
  <input type="text" id="savingThrows" placeholder="e.g. STR +3, DEX +2">
</div>

<div class="section">
  <label for="skills">Skills</label>
  <input type="text" id="skills" placeholder="e.g. Stealth +4, Perception +5">
</div>

<div class="section">
  <label for="damageImmunities">Damage Immunities</label>
  <input type="text" id="damageImmunities" placeholder="e.g. fire, poison">
</div>

<div class="section">
  <label for="damageResistances">Damage Resistances</label>
  <input type="text" id="damageResistances" placeholder="e.g. cold, lightning">
</div>

<div class="section">
  <label for="damageVulnerabilities">Damage Vulnerabilities</label>
  <input type="text" id="damageVulnerabilities" placeholder="e.g. bludgeoning">
</div>

<div class="section">
  <label for="conditionImmunities">Condition Immunities</label>
  <input type="text" id="conditionImmunities" placeholder="e.g. charmed, frightened">
</div>

<div class="section">
  <label for="senses">Senses</label>
  <input type="text" id="senses" placeholder="e.g. darkvision 60 ft., passive Perception 12">
</div>

<div class="section">
  <label for="languages">Languages</label>
  <input type="text" id="languages" placeholder="e.g. Common, Draconic">
</div>


<div class="section">
<h3>Traits</h3>
<div id="traits-list"></div>
<button type="button" id="add-trait-btn">Add Trait</button>
</div>

<div class="section">
<h3>Actions</h3>
<div id="actions-list"></div>
<button type="button" id="add-action-btn">Add Action</button>
</div>

<div class="section">
<h3>Reactions</h3>
<div id="reactions-list"></div>
<button type="button" id="add-reaction-btn">Add Reaction</button>
</div>

<div class="section">
  <h3>Legendary Actions</h3>
  <div id="legendary-list"></div>
  <button type="button" id="add-legendary-btn">Add Legendary Action</button>
  
  <label for="monster-legendarynumber">Legendary Actions per Round</label>
  <input type="number" id="monster-legendarynumber" placeholder="e.g. 3">
</div>


<div class="section">
<h3>Lair Actions</h3>
<div id="lair-list"></div>
<button type="button" id="add-lair-btn">Add Lair Action</button>
</div>

<div class="section">
<h3>Regional Effects</h3>
<div id="regional-list"></div>
<button type="button" id="add-regional-btn">Add Regional Effect</button>
</div>

<div class="section">
  <h3>Monster Description</h3>
  <textarea id="monster-description" placeholder="A small description of the creature" rows="4" cols="60"></textarea>
</div>

<label>Challenge Rating (CR)</label>
<input type="text" id="monster-cr" placeholder="1/4">

<button type="button" id="preview-btn">Preview Stat Block</button>
<button type="button" id="save-btn">Save as JSON</button>
</form>

<div id="stat-block"></div>

<script>
// --- Helper to add row ---
function createRow(container, placeholders) {
const row = document.createElement("div");
row.classList.add("row");

placeholders.forEach((ph) => {
const input = document.createElement("input");
input.placeholder = ph;
row.appendChild(input);
});

const removeBtn = document.createElement("button");
removeBtn.textContent = "Remove";
removeBtn.type = "button";
removeBtn.addEventListener("click", () => row.remove());
row.appendChild(removeBtn);

container.appendChild(row);
}

// --- Collect Monster Data ---
function getMonsterData() {
  return {
    name: document.getElementById("monster-name").value,
    tags: [document.getElementById("monster-source").value || "homebrew"],
    size: document.getElementById("monster-size").value,
    type: document.getElementById("monster-type").value,
    alignment: document.getElementById("monster-alignment").value,
    cr: document.getElementById("monster-cr").value,
    hp: document.getElementById("monster-hp").value,
    ac: document.getElementById("monster-ac").value,
    speed: document.getElementById("monster-speed").value,
    abilities: {
      str: parseInt(document.getElementById("str").value) || 0,
      dex: parseInt(document.getElementById("dex").value) || 0,
      con: parseInt(document.getElementById("con").value) || 0,
      int: parseInt(document.getElementById("int").value) || 0,
      wis: parseInt(document.getElementById("wis").value) || 0,
      cha: parseInt(document.getElementById("cha").value) || 0
    },
	saves: document.getElementById("savingThrows").value,
	skills: document.getElementById("skills").value,
	immunities: document.getElementById("damageImmunities").value,
	resistance: document.getElementById("damageResistances").value,
	vulnerability: document.getElementById("damageVulnerabilities").value,
	conimmunities: document.getElementById("conditionImmunities").value,
	senses: document.getElementById("senses").value,
	languages: document.getElementById("languages").value,
    legendarynumber: document.getElementById("monster-legendarynumber").value,
    traits: Array.from(document.querySelectorAll("#traits-container .trait")).map(trait => ({
      name: trait.querySelector(".trait-name").value,
      desc: trait.querySelector(".trait-desc").value
    })),
    actions: Array.from(document.querySelectorAll("#actions-container .action")).map(action => ({
      name: action.querySelector(".action-name").value,
      desc: action.querySelector(".action-desc").value
    })),
    reactions: Array.from(document.querySelectorAll("#reactions-container .reaction")).map(reaction => ({
      name: reaction.querySelector(".reaction-name").value,
      desc: reaction.querySelector(".reaction-desc").value
    })),
    legendary: Array.from(document.querySelectorAll("#legendary-container .legendary")).map(legendary => ({
      name: legendary.querySelector(".legendary-name").value,
      desc: legendary.querySelector(".legendary-desc").value
    })),
    description: document.getElementById("monster-description").value,
    lairactions: Array.from(document.querySelectorAll("#lairactions-container .lairaction")).map(lair => ({
      description: lair.querySelector(".lair-desc").value,
      bullets: Array.from(lair.querySelectorAll(".lair-bullet")).map(b => b.value).filter(Boolean)
    })),
    regionaleffects: Array.from(document.querySelectorAll("#regionaleffects-container .regionaleffect")).map(region => ({
      description: region.querySelector(".regional-desc").value,
      bullets: Array.from(region.querySelectorAll(".regional-bullet")).map(b => b.value).filter(Boolean),
      secondaryDescription: region.querySelector(".regional-secondary-desc").value
    })),
    _file: "custom_monster_template.json",
    _displayName: document.getElementById("monster-name").value
  };
}

// --- Format Stat Block ---
const statBlock = document.getElementById("stat-block");
function formatStatBlock(m) {
const formatAbility = (score) => {
const mod = Math.floor((score - 10) / 2);
return `${score} (${mod >= 0 ? '+'+mod : mod})`;
};
return `
   <h2>${m.name}</h2>
   <p>${m.size} ${m.type}${m.alignment ? ", "+m.alignment : ""}</p>
   <p><strong>AC:</strong> ${m.ac} | <strong>HP:</strong> ${m.hp} | <strong>Speed:</strong> ${m.speed}</p>
   <hr>
   <h3>Abilities</h3>
   <p>STR: ${formatAbility(m.abilities.str)}, DEX: ${formatAbility(m.abilities.dex)}, CON: ${formatAbility(m.abilities.con)}, INT: ${formatAbility(m.abilities.int)}, WIS: ${formatAbility(m.abilities.wis)}, CHA: ${formatAbility(m.abilities.cha)}</p>
   <hr>
   ${m.traits.length ? `<h3>Traits</h3>${m.traits.map(t => `<p><strong>${t.name}:</strong> ${t.desc}</p>`).join("")}` : ""}
   ${m.actions.length ? `<h3>Actions</h3>${m.actions.map(a => `<p><strong>${a.name}:</strong> ${a.desc}</p>`).join("")}` : ""}
   <hr>
   <p><strong>Challenge:</strong> ${m.cr}</p>
 `;
}

// --- Buttons ---
document.getElementById("preview-btn").addEventListener("click", () => {
const monster = getMonsterData();
statBlock.innerHTML = formatStatBlock(monster);
});

document.getElementById("save-btn").addEventListener("click", () => {
  const monster = getMonsterData();

  // build filename from monster name (fallback to "monster")
  const filename = `${monster.name || "monster"}.json`;
  monster._file = filename;  // inject into JSON
  monster._displayName = monster.name || "Unnamed Monster"; // optional: also keep display name

  const blob = new Blob([JSON.stringify(monster, null, 2)], {type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = filename;
  a.click();
  URL.revokeObjectURL(url);
});


// Helper to create Name + Description entry (traits, actions, reactions, legendary)
function createNameDescBlock(containerId, type) {
  const div = document.createElement("div");
  div.classList.add("entry-block");

  const nameInput = document.createElement("input");
  nameInput.type = "text";
  nameInput.placeholder = `${type} Name`;

  const descInput = document.createElement("textarea");
  descInput.placeholder = `${type} Description`;
  descInput.rows = 3;
  descInput.cols = 50;

  const removeBtn = document.createElement("button");
  removeBtn.type = "button";
  removeBtn.textContent = "Remove";
  removeBtn.addEventListener("click", () => div.remove());

  div.appendChild(nameInput);
  div.appendChild(document.createElement("br"));
  div.appendChild(descInput);
  div.appendChild(document.createElement("br"));
  div.appendChild(removeBtn);

  document.getElementById(containerId).appendChild(div);
}

// Helper for Lair Actions (description + bullet list)
function createLairBlock(containerId) {
  const div = document.createElement("div");
  div.classList.add("entry-block");

  const descInput = document.createElement("textarea");
  descInput.placeholder = "Lair Action Description";
  descInput.rows = 3;
  descInput.cols = 50;

  const bulletsDiv = document.createElement("div");
  const addBulletBtn = document.createElement("button");
  addBulletBtn.type = "button";
  addBulletBtn.textContent = "Add Bullet";

  addBulletBtn.addEventListener("click", () => {
    const bulletWrapper = document.createElement("div");
    bulletWrapper.style.display = "flex";
    bulletWrapper.style.alignItems = "center";
    bulletWrapper.style.marginBottom = "4px";

    const bulletInput = document.createElement("input");
    bulletInput.type = "text";
    bulletInput.placeholder = "Bullet";
    bulletInput.style.flex = "1";

    const removeBulletBtn = document.createElement("button");
    removeBulletBtn.type = "button";
    removeBulletBtn.textContent = "✖";
    removeBulletBtn.style.marginLeft = "6px";
    removeBulletBtn.addEventListener("click", () => bulletWrapper.remove());

    bulletWrapper.appendChild(bulletInput);
    bulletWrapper.appendChild(removeBulletBtn);

    bulletsDiv.appendChild(bulletWrapper);
  });

  const removeBtn = document.createElement("button");
  removeBtn.type = "button";
  removeBtn.textContent = "Remove";
  removeBtn.addEventListener("click", () => div.remove());

  div.appendChild(descInput);
  div.appendChild(document.createElement("br"));
  div.appendChild(bulletsDiv);
  div.appendChild(addBulletBtn);
  div.appendChild(document.createElement("br"));
  div.appendChild(removeBtn);

  document.getElementById(containerId).appendChild(div);
}

// Helper for Regional Effects (description + bullets + secondaryDescription)
function createRegionalBlock(containerId) {
  const div = document.createElement("div");
  div.classList.add("entry-block");

  const descInput = document.createElement("textarea");
  descInput.placeholder = "Regional Effect Description";
  descInput.rows = 3;
  descInput.cols = 50;

  const bulletsDiv = document.createElement("div");
  const addBulletBtn = document.createElement("button");
  addBulletBtn.type = "button";
  addBulletBtn.textContent = "Add Bullet";

  addBulletBtn.addEventListener("click", () => {
    const bulletWrapper = document.createElement("div");
    bulletWrapper.style.display = "flex";
    bulletWrapper.style.alignItems = "center";
    bulletWrapper.style.marginBottom = "4px";

    const bulletInput = document.createElement("input");
    bulletInput.type = "text";
    bulletInput.placeholder = "Bullet";
    bulletInput.style.flex = "1";

    const removeBulletBtn = document.createElement("button");
    removeBulletBtn.type = "button";
    removeBulletBtn.textContent = "✖";
    removeBulletBtn.style.marginLeft = "6px";
    removeBulletBtn.addEventListener("click", () => bulletWrapper.remove());

    bulletWrapper.appendChild(bulletInput);
    bulletWrapper.appendChild(removeBulletBtn);

    bulletsDiv.appendChild(bulletWrapper);
  });

  const secondaryInput = document.createElement("textarea");
  secondaryInput.placeholder = "Secondary Description";
  secondaryInput.rows = 2;
  secondaryInput.cols = 50;

  const removeBtn = document.createElement("button");
  removeBtn.type = "button";
  removeBtn.textContent = "Remove";
  removeBtn.addEventListener("click", () => div.remove());

  div.appendChild(descInput);
  div.appendChild(document.createElement("br"));
  div.appendChild(bulletsDiv);
  div.appendChild(addBulletBtn);
  div.appendChild(document.createElement("br"));
  div.appendChild(secondaryInput);
  div.appendChild(document.createElement("br"));
  div.appendChild(removeBtn);

  document.getElementById(containerId).appendChild(div);
}




// Event listeners
document.getElementById("add-trait-btn").addEventListener("click", () => {
createNameDescBlock("traits-list", "Trait");
});

document.getElementById("add-action-btn").addEventListener("click", () => {
createNameDescBlock("actions-list", "Action");
});

document.getElementById("add-reaction-btn").addEventListener("click", () => {
createNameDescBlock("reactions-list", "Reaction");
});

document.getElementById("add-legendary-btn").addEventListener("click", () => {
createNameDescBlock("legendary-list", "Legendary Action");
});

document.getElementById("add-lair-btn").addEventListener("click", () => {
createLairBlock("lair-list");
});

document.getElementById("add-regional-btn").addEventListener("click", () => {
createRegionalBlock("regional-list");
});



</script>

</body>
</html>