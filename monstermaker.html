<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Monster Maker</title>
<style>
  body { font-family: sans-serif; max-width: 900px; margin: auto; padding: 20px; }
  input, select, textarea, button { margin-bottom: 10px; padding: 5px; width: 100%; }
  label { font-weight: bold; margin-top: 10px; display: block; }
  .section { border: 1px solid #ccc; padding: 10px; margin-top: 10px; background: #f9f9f9; }
  .row { display: flex; gap: 10px; margin-bottom: 5px; }
  .row input { flex: 1; }
  .row button { flex: 0 0 80px; }
  #stat-block { border: 1px solid #ccc; padding: 10px; margin-top: 20px; background: #fffbe0; }
</style>
</head>
<body>

<h1>Monster Maker</h1>

<form id="monster-form">
  <label>Name</label>
  <input type="text" id="monster-name" placeholder="Goblin">

  <label>Type</label>
  <select id="monster-type">
    <option value="aberration">Aberration</option>
    <option value="beast">Beast</option>
    <option value="celestial">Celestial</option>
    <option value="construct">Construct</option>
    <option value="dragon">Dragon</option>
    <option value="elemental">Elemental</option>
    <option value="fey">Fey</option>
    <option value="fiend">Fiend</option>
    <option value="giant">Giant</option>
    <option value="humanoid">Humanoid</option>
    <option value="monstrosity">Monstrosity</option>
    <option value="ooze">Ooze</option>
    <option value="plant">Plant</option>
    <option value="undead">Undead</option>
  </select>

  <label>Alignment</label>
  <select id="monster-alignment">
    <option>Lawful Good</option>
    <option>Lawful Neutral</option>
    <option>Lawful Evil</option>
    <option>Neutral Good</option>
    <option>True Neutral</option>
    <option>Neutral Evil</option>
    <option>Chaotic Good</option>
    <option>Chaotic Neutral</option>
    <option>Chaotic Evil</option>
  </select>

  <label>Size</label>
  <select id="monster-size">
    <option>Small</option>
    <option>Medium</option>
    <option>Large</option>
    <option>Huge</option>
    <option>Gargantuan</option>
  </select>

  <label>AC</label>
  <input type="number" id="monster-ac" placeholder="15">

  <label>HP</label>
  <input type="number" id="monster-hp" placeholder="30">

  <label>Speed</label>
  <input type="text" id="monster-speed" placeholder="30 ft.">

  <div class="section">
    <h3>Abilities</h3>
    <div id="abilities-list"></div>
    <button type="button" id="add-ability-btn">Add Ability</button>
  </div>

  <div class="section">
    <h3>Traits</h3>
    <div id="traits-list"></div>
    <button type="button" id="add-trait-btn">Add Trait</button>
  </div>

  <div class="section">
    <h3>Actions</h3>
    <div id="actions-list"></div>
    <button type="button" id="add-action-btn">Add Action</button>
  </div>

  <label>Challenge Rating (CR)</label>
  <input type="text" id="monster-cr" placeholder="1/4">

  <button type="button" id="preview-btn">Preview Stat Block</button>
  <button type="button" id="save-btn">Save as JSON</button>
</form>

<div id="stat-block"></div>

<script>
// --- Helper to add row ---
function createRow(container, placeholders, isNameDesc = false) {
  const row = document.createElement("div");
  row.classList.add("row");

  placeholders.forEach((ph, i) => {
    const input = document.createElement("input");
    input.placeholder = ph;
    row.appendChild(input);
  });

  const removeBtn = document.createElement("button");
  removeBtn.textContent = "Remove";
  removeBtn.type = "button";
  removeBtn.addEventListener("click", () => row.remove());
  row.appendChild(removeBtn);

  container.appendChild(row);
}

// --- Dynamic Fields ---
document.getElementById("add-ability-btn").addEventListener("click", () => {
  createRow(document.getElementById("abilities-list"), ["STR", "DEX", "CON", "INT", "WIS", "CHA"]);
});
document.getElementById("add-trait-btn").addEventListener("click", () => {
  createRow(document.getElementById("traits-list"), ["Name", "Description"]);
});
document.getElementById("add-action-btn").addEventListener("click", () => {
  createRow(document.getElementById("actions-list"), ["Name", "Description"]);
});

// --- Collect Monster Data ---
function getMonsterData() {
  const abilitiesRows = document.getElementById("abilities-list").querySelectorAll(".row");
  const abilities = {};
  abilitiesRows.forEach(row => {
    const inputs = row.querySelectorAll("input");
    if(inputs.length === 6){
      abilities.str = parseInt(inputs[0].value) || 0;
      abilities.dex = parseInt(inputs[1].value) || 0;
      abilities.con = parseInt(inputs[2].value) || 0;
      abilities.int = parseInt(inputs[3].value) || 0;
      abilities.wis = parseInt(inputs[4].value) || 0;
      abilities.cha = parseInt(inputs[5].value) || 0;
    }
  });

  const traits = [];
  document.getElementById("traits-list").querySelectorAll(".row").forEach(row => {
    const [name, desc] = row.querySelectorAll("input");
    if(name.value) traits.push({name: name.value, desc: desc.value});
  });

  const actions = [];
  document.getElementById("actions-list").querySelectorAll(".row").forEach(row => {
    const [name, desc] = row.querySelectorAll("input");
    if(name.value) actions.push({name: name.value, desc: desc.value});
  });

  return {
    name: document.getElementById("monster-name").value,
    type: document.getElementById("monster-type").value,
    size: document.getElementById("monster-size").value,
    alignment: document.getElementById("monster-alignment").value,
    ac: document.getElementById("monster-ac").value,
    hp: document.getElementById("monster-hp").value,
    speed: document.getElementById("monster-speed").value,
    abilities,
    traits,
    actions,
    cr: document.getElementById("monster-cr").value
  };
}

// --- Format Stat Block ---
const statBlock = document.getElementById("stat-block");
function formatStatBlock(m) {
  const formatAbility = (score) => {
    const mod = Math.floor((score - 10) / 2);
    return `${score} (${mod >= 0 ? '+'+mod : mod})`;
  };
  return `
    <h2>${m.name}</h2>
    <p>${m.size} ${m.type}${m.alignment ? ", "+m.alignment : ""}</p>
    <p><strong>AC:</strong> ${m.ac} | <strong>HP:</strong> ${m.hp} | <strong>Speed:</strong> ${m.speed}</p>
    <hr>
    <h3>Abilities</h3>
    <p>STR: ${formatAbility(m.abilities.str || 0)}, DEX: ${formatAbility(m.abilities.dex || 0)}, CON: ${formatAbility(m.abilities.con || 0)}, INT: ${formatAbility(m.abilities.int || 0)}, WIS: ${formatAbility(m.abilities.wis || 0)}, CHA: ${formatAbility(m.abilities.cha || 0)}</p>
    <hr>
    ${m.traits.length ? `<h3>Traits</h3>${m.traits.map(t => `<p><strong>${t.name}:</strong> ${t.desc}</p>`).join("")}` : ""}
    ${m.actions.length ? `<h3>Actions</h3>${m.actions.map(a => `<p><strong>${a.name}:</strong> ${a.desc}</p>`).join("")}` : ""}
    <hr>
    <p><strong>Challenge:</strong> ${m.cr}</p>
  `;
}

// --- Buttons ---
document.getElementById("preview-btn").addEventListener("click", () => {
  const monster = getMonsterData();
  statBlock.innerHTML = formatStatBlock(monster);
});

document.getElementById("save-btn").addEventListener("click", () => {
  const monster = getMonsterData();
  const blob = new Blob([JSON.stringify(monster, null, 2)], {type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = `${monster.name || "monster"}.json`;
  a.click();
  URL.revokeObjectURL(url);
});
</script>

</body>
</html>
